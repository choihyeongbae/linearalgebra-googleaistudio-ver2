<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Movie Matcher AI</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Recharts (UMD) -->
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.min.js"></script>
    
    <!-- Babel Standalone (브라우저에서 JSX/TS 컴파일) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #0f172a; /* Slate 900 */
        color: #f8fafc;
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #1e293b;
      }
      ::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "recharts": "https://esm.sh/recharts@^3.5.1"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <!-- 통합된 애플리케이션 스크립트 -->
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Radar, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, ResponsiveContainer, Legend } = Recharts;

        // ----------------------------------------------------------------------
        // 1. UTILS (utils.ts)
        // ----------------------------------------------------------------------
        
        /**
         * Cosine Similarity = (A . B) / (||A|| * ||B||)
         */
        const calculateCosineSimilarity = (vecA, vecB) => {
          const dotProduct = (vecA.action * vecB.action) + (vecA.story * vecB.story) + (vecA.visual * vecB.visual);
          
          const magnitudeA = Math.sqrt(Math.pow(vecA.action, 2) + Math.pow(vecA.story, 2) + Math.pow(vecA.visual, 2));
          const magnitudeB = Math.sqrt(Math.pow(vecB.action, 2) + Math.pow(vecB.story, 2) + Math.pow(vecB.visual, 2));

          if (magnitudeA === 0 || magnitudeB === 0) {
            return 0;
          }

          return dotProduct / (magnitudeA * magnitudeB);
        };

        const getRecommendations = (userPreferences, database, limit = 5) => {
          const scoredMovies = database.map((movie) => {
            const similarity = calculateCosineSimilarity(userPreferences, movie.vectors);
            return { ...movie, similarity };
          });

          // Sort by similarity descending
          scoredMovies.sort((a, b) => b.similarity - a.similarity);

          return scoredMovies.slice(0, limit);
        };

        const formatScore = (score) => {
          return (score * 100).toFixed(1) + "%";
        };

        // ----------------------------------------------------------------------
        // 2. DATA (data.ts)
        // ----------------------------------------------------------------------
        const movieDatabase = [
          {
            id: 1,
            title: "The Dark Knight",
            year: 2008,
            director: "Christopher Nolan",
            genres: ["Action", "Crime", "Drama"],
            description: "Batman raises the stakes in his war on crime when the Joker creates chaos.",
            vectors: { action: 9, story: 9, visual: 8 }
          },
          {
            id: 2,
            title: "Inception",
            year: 2010,
            director: "Christopher Nolan",
            genres: ["Sci-Fi", "Action"],
            description: "A thief who steals corporate secrets through dream-sharing technology is given the inverse task of planting an idea.",
            vectors: { action: 8, story: 9, visual: 10 }
          },
          {
            id: 3,
            title: "The Grand Budapest Hotel",
            year: 2014,
            director: "Wes Anderson",
            genres: ["Adventure", "Comedy"],
            description: "A writer encounters the owner of an aging high-class hotel, who tells him of his early years serving as a lobby boy.",
            vectors: { action: 4, story: 7, visual: 10 }
          },
          {
            id: 4,
            title: "Mad Max: Fury Road",
            year: 2015,
            director: "George Miller",
            genres: ["Action", "Adventure"],
            description: "In a post-apocalyptic wasteland, a woman rebels against a tyrannical ruler in search for her homeland.",
            vectors: { action: 10, story: 5, visual: 10 }
          },
          {
            id: 5,
            title: "Parasite",
            year: 2019,
            director: "Bong Joon Ho",
            genres: ["Thriller", "Drama"],
            description: "Greed and class discrimination threaten the newly formed symbiotic relationship between the wealthy Park family and the destitute Kim clan.",
            vectors: { action: 3, story: 10, visual: 8 }
          },
          {
            id: 6,
            title: "The Godfather",
            year: 1972,
            director: "Francis Ford Coppola",
            genres: ["Crime", "Drama"],
            description: "The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.",
            vectors: { action: 5, story: 10, visual: 7 }
          },
          {
            id: 7,
            title: "Avengers: Endgame",
            year: 2019,
            director: "Anthony & Joe Russo",
            genres: ["Action", "Sci-Fi"],
            description: "After the devastating events of Infinity War, the universe is in ruins. The Avengers assemble once more.",
            vectors: { action: 10, story: 6, visual: 9 }
          },
          {
            id: 8,
            title: "Eternal Sunshine of the Spotless Mind",
            year: 2004,
            director: "Michel Gondry",
            genres: ["Romance", "Sci-Fi"],
            description: "When their relationship turns sour, a couple undergoes a medical procedure to have each other erased from their memories.",
            vectors: { action: 2, story: 10, visual: 8 }
          },
          {
            id: 9,
            title: "Interstellar",
            year: 2014,
            director: "Christopher Nolan",
            genres: ["Sci-Fi", "Drama"],
            description: "A team of explorers travel through a wormhole in space in an attempt to ensure humanity's survival.",
            vectors: { action: 6, story: 8, visual: 10 }
          },
          {
            id: 10,
            title: "John Wick",
            year: 2014,
            director: "Chad Stahelski",
            genres: ["Action", "Thriller"],
            description: "An ex-hit-man comes out of retirement to track down the gangsters that killed his dog and took everything from him.",
            vectors: { action: 10, story: 4, visual: 7 }
          },
          {
            id: 11,
            title: "Spirited Away",
            year: 2001,
            director: "Hayao Miyazaki",
            genres: ["Animation", "Adventure"],
            description: "During her family's move to the suburbs, a sullen 10-year-old girl wanders into a world ruled by gods, witches, and spirits.",
            vectors: { action: 4, story: 9, visual: 10 }
          },
          {
            id: 12,
            title: "Pulp Fiction",
            year: 1994,
            director: "Quentin Tarantino",
            genres: ["Crime", "Drama"],
            description: "The lives of two mob hitmen, a boxer, a gangster and his wife, and a pair of diner bandits intertwine in four tales of violence and redemption.",
            vectors: { action: 7, story: 9, visual: 7 }
          },
          {
            id: 13,
            title: "1917",
            year: 2019,
            director: "Sam Mendes",
            genres: ["War", "Drama"],
            description: "April 6th, 1917. As a regiment assembles to wage war deep in enemy territory, two soldiers are assigned to race against time and deliver a message.",
            vectors: { action: 8, story: 6, visual: 10 }
          },
          {
            id: 14,
            title: "Her",
            year: 2013,
            director: "Spike Jonze",
            genres: ["Romance", "Sci-Fi"],
            description: "In a near future, a lonely writer develops an unlikely relationship with an operating system designed to meet his every need.",
            vectors: { action: 1, story: 9, visual: 8 }
          },
          {
            id: 15,
            title: "Blade Runner 2049",
            year: 2017,
            director: "Denis Villeneuve",
            genres: ["Sci-Fi", "Action"],
            description: "Young Blade Runner K's discovery of a long-buried secret leads him to track down former Blade Runner Rick Deckard.",
            vectors: { action: 7, story: 8, visual: 10 }
          },
          {
            id: 16,
            title: "The Matrix",
            year: 1999,
            director: "Lana & Lilly Wachowski",
            genres: ["Sci-Fi", "Action"],
            description: "A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.",
            vectors: { action: 9, story: 8, visual: 9 }
          },
          {
            id: 17,
            title: "La La Land",
            year: 2016,
            director: "Damien Chazelle",
            genres: ["Comedy", "Drama", "Music"],
            description: "While navigating their careers in Los Angeles, a pianist and an actress fall in love while attempting to reconcile their aspirations for the future.",
            vectors: { action: 2, story: 7, visual: 9 }
          },
          {
            id: 18,
            title: "Gladiator",
            year: 2000,
            director: "Ridley Scott",
            genres: ["Action", "Adventure"],
            description: "A former Roman General sets out to exact vengeance against the corrupt emperor who murdered his family and sent him into slavery.",
            vectors: { action: 9, story: 8, visual: 8 }
          },
          {
            id: 19,
            title: "Whiplash",
            year: 2014,
            director: "Damien Chazelle",
            genres: ["Drama", "Music"],
            description: "A promising young drummer enrolls at a cut-throat music conservatory where his dreams of greatness are mentored by an instructor who will stop at nothing.",
            vectors: { action: 5, story: 9, visual: 6 }
          },
          {
            id: 20,
            title: "Dune: Part One",
            year: 2021,
            director: "Denis Villeneuve",
            genres: ["Sci-Fi", "Adventure"],
            description: "A noble family becomes embroiled in a war for control over the galaxy's most valuable asset while its heir becomes troubled by visions of a dark future.",
            vectors: { action: 7, story: 8, visual: 10 }
          },
          {
            id: 21,
            title: "Oldboy",
            year: 2003,
            director: "Park Chan-wook",
            genres: ["Action", "Mystery"],
            description: "After being kidnapped and imprisoned for fifteen years, Oh Dae-Su is released, only to find that he must find his captor in five days.",
            vectors: { action: 9, story: 9, visual: 9 }
          },
          {
            id: 22,
            title: "Before Sunrise",
            year: 1995,
            director: "Richard Linklater",
            genres: ["Romance", "Drama"],
            description: "A young man and woman meet on a train in Europe, and wind up spending one evening together in Vienna.",
            vectors: { action: 1, story: 10, visual: 5 }
          },
          {
            id: 23,
            title: "Top Gun: Maverick",
            year: 2022,
            director: "Joseph Kosinski",
            genres: ["Action", "Drama"],
            description: "After thirty years, Maverick is still pushing the envelope as a top naval aviator, but must confront ghosts of his past.",
            vectors: { action: 10, story: 6, visual: 9 }
          },
          {
            id: 24,
            title: "Spider-Man: Into the Spider-Verse",
            year: 2018,
            director: "Bob Persichetti",
            genres: ["Animation", "Action"],
            description: "Teen Miles Morales becomes the Spider-Man of his universe, and must join with five spider-powered individuals from other dimensions.",
            vectors: { action: 9, story: 8, visual: 10 }
          },
          {
            id: 25,
            title: "Schindler's List",
            year: 1993,
            director: "Steven Spielberg",
            genres: ["Biography", "Drama"],
            description: "In German-occupied Poland during World War II, industrialist Oskar Schindler gradually becomes concerned for his Jewish workforce.",
            vectors: { action: 4, story: 10, visual: 8 }
          }
        ];

        // ----------------------------------------------------------------------
        // 3. COMPONENTS
        // ----------------------------------------------------------------------

        // PreferenceSlider.tsx
        const PreferenceSlider = ({ label, value, onChange, description, icon, colorClass }) => {
          return (
            <div className="mb-6 p-4 bg-slate-800/50 rounded-xl border border-slate-700 backdrop-blur-sm">
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center gap-2">
                  <div className={`p-2 rounded-lg bg-slate-800 ${colorClass}`}>
                    {icon}
                  </div>
                  <div>
                    <h3 className="font-semibold text-white">{label}</h3>
                    <p className="text-xs text-slate-400">{description}</p>
                  </div>
                </div>
                <span className={`text-xl font-bold ${colorClass}`}>{value}</span>
              </div>
              
              <input
                type="range"
                min="1"
                max="10"
                step="1"
                value={value}
                onChange={(e) => onChange(Number(e.target.value))}
                className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500 hover:bg-slate-600 transition-colors"
              />
              <div className="flex justify-between mt-1 text-xs text-slate-500 font-mono">
                <span>Low</span>
                <span>High</span>
              </div>
            </div>
          );
        };

        // SimilarityRadar.tsx
        const SimilarityRadar = ({ userVector, movieVector, movieTitle }) => {
          const data = [
            { subject: 'Action', User: userVector.action, Movie: movieVector.action, fullMark: 10 },
            { subject: 'Story', User: userVector.story, Movie: movieVector.story, fullMark: 10 },
            { subject: 'Visuals', User: userVector.visual, Movie: movieVector.visual, fullMark: 10 },
          ];

          return (
            <div className="w-full h-[300px] mt-4">
              <ResponsiveContainer width="100%" height="100%">
                <RadarChart cx="50%" cy="50%" outerRadius="70%" data={data}>
                  <PolarGrid stroke="#475569" />
                  <PolarAngleAxis dataKey="subject" tick={{ fill: '#cbd5e1', fontSize: 12, fontWeight: 'bold' }} />
                  <PolarRadiusAxis angle={30} domain={[0, 10]} tick={false} axisLine={false} />
                  
                  <Radar
                    name="My Preference"
                    dataKey="User"
                    stroke="#3b82f6"
                    strokeWidth={2}
                    fill="#3b82f6"
                    fillOpacity={0.4}
                  />
                  <Radar
                    name={movieTitle.length > 15 ? movieTitle.substring(0, 15) + '...' : movieTitle}
                    dataKey="Movie"
                    stroke="#10b981"
                    strokeWidth={2}
                    fill="#10b981"
                    fillOpacity={0.4}
                  />
                  <Legend wrapperStyle={{ fontSize: '12px', marginTop: '10px' }}/>
                </RadarChart>
              </ResponsiveContainer>
            </div>
          );
        };

        // MovieCard.tsx
        const MovieCard = ({ movie, rank, userVector }) => {
          const [expanded, setExpanded] = useState(false);

          const getBorderColor = (score) => {
            if (score > 0.95) return 'border-emerald-400';
            if (score > 0.90) return 'border-blue-400';
            return 'border-slate-700';
          };

          return (
            <div 
              className={`bg-slate-800 rounded-xl overflow-hidden transition-all duration-300 border-l-4 ${getBorderColor(movie.similarity)} shadow-lg mb-4`}
            >
              <div 
                className="p-5 cursor-pointer hover:bg-slate-700/50 transition-colors"
                onClick={() => setExpanded(!expanded)}
              >
                <div className="flex justify-between items-start">
                  <div className="flex gap-4">
                    <div className="flex flex-col items-center justify-center w-12 h-12 bg-slate-900 rounded-full font-bold text-xl text-slate-300 border border-slate-700 shrink-0">
                      #{rank}
                    </div>
                    <div>
                      <h3 className="font-bold text-lg text-white leading-tight">{movie.title} <span className="text-slate-400 font-normal text-sm">({movie.year})</span></h3>
                      <p className="text-slate-400 text-sm mt-1">{movie.director}</p>
                      <div className="flex gap-2 mt-2 flex-wrap">
                        {movie.genres.map(g => (
                          <span key={g} className="px-2 py-0.5 rounded bg-slate-900 text-slate-300 text-xs border border-slate-700">
                            {g}
                          </span>
                        ))}
                      </div>
                    </div>
                  </div>
                  
                  <div className="text-right">
                    <div className="text-2xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
                      {formatScore(movie.similarity)}
                    </div>
                    <div className="text-xs text-slate-500 uppercase tracking-wider font-semibold">Match</div>
                  </div>
                </div>

                {/* Preview of breakdown */}
                <div className="mt-4 flex gap-4 text-xs text-slate-400 font-mono">
                   <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-red-500"></span> Act: {movie.vectors.action}</span>
                   <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-purple-500"></span> Sty: {movie.vectors.story}</span>
                   <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-cyan-500"></span> Vis: {movie.vectors.visual}</span>
                </div>
              </div>

              {/* Expanded Details */}
              <div className={`overflow-hidden transition-all duration-500 ease-in-out ${expanded ? 'max-h-[600px] opacity-100' : 'max-h-0 opacity-0'}`}>
                <div className="p-5 pt-0 border-t border-slate-700 bg-slate-800/80">
                  <p className="text-slate-300 italic mt-4 mb-4 leading-relaxed">
                    "{movie.description}"
                  </p>
                  
                  <div className="bg-slate-900 rounded-lg p-4 border border-slate-700">
                    <h4 className="text-sm font-semibold text-slate-400 mb-2 uppercase tracking-wide text-center">Vector Analysis</h4>
                    <SimilarityRadar 
                      userVector={userVector}
                      movieVector={movie.vectors}
                      movieTitle={movie.title}
                    />
                    <p className="text-center text-xs text-slate-500 mt-2">
                      Comparison of your preferences (Blue) vs. {movie.title} (Green)
                    </p>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // ----------------------------------------------------------------------
        // 4. MAIN APP (App.tsx)
        // ----------------------------------------------------------------------
        
        // Icons
        const ActionIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-red-400"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M8 13h8"/><path d="M8 17h8"/><path d="M10 9h8"/></svg>
        );
        const StoryIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-purple-400"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        );
        const VisualIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-cyan-400"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
        );

        const App = () => {
          const [preferences, setPreferences] = useState({
            action: 5,
            story: 5,
            visual: 5,
          });

          const [recommendations, setRecommendations] = useState([]);

          useEffect(() => {
            const results = getRecommendations(preferences, movieDatabase, 10);
            setRecommendations(results);
          }, [preferences]);

          const handleSliderChange = (key, value) => {
            setPreferences(prev => ({
              ...prev,
              [key]: value
            }));
          };

          return (
            <div className="min-h-screen pb-12">
              <header className="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 mb-8">
                <div className="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
                      </svg>
                    </div>
                    <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
                      Movie Matcher AI
                    </h1>
                  </div>
                  <div className="text-xs font-mono text-slate-500">
                    Powered by Cosine Similarity
                  </div>
                </div>
              </header>

              <main className="max-w-4xl mx-auto px-4 grid grid-cols-1 md:grid-cols-12 gap-8">
                
                {/* Left Column: Controls */}
                <div className="md:col-span-5 lg:col-span-4 space-y-2">
                  <div className="sticky top-24">
                    <h2 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                      <span className="w-1 h-6 bg-blue-500 rounded-full"></span>
                      Define Your Taste
                    </h2>
                    <p className="text-sm text-slate-400 mb-6">
                      Adjust the sliders below to find movies that match your current mood.
                    </p>

                    <PreferenceSlider
                      label="Action & Intensity"
                      description="Pacing, thrills, and excitement"
                      value={preferences.action}
                      onChange={(val) => handleSliderChange('action', val)}
                      icon={<ActionIcon />}
                      colorClass="text-red-400"
                    />

                    <PreferenceSlider
                      label="Story & Depth"
                      description="Plot complexity, emotion, drama"
                      value={preferences.story}
                      onChange={(val) => handleSliderChange('story', val)}
                      icon={<StoryIcon />}
                      colorClass="text-purple-400"
                    />

                    <PreferenceSlider
                      label="Visuals & Aesthetics"
                      description="Cinematography, effects, art"
                      value={preferences.visual}
                      onChange={(val) => handleSliderChange('visual', val)}
                      icon={<VisualIcon />}
                      colorClass="text-cyan-400"
                    />

                    <div className="p-4 rounded-lg bg-blue-900/20 border border-blue-900/50 mt-6">
                      <h4 className="text-xs font-bold text-blue-400 uppercase mb-2">How it works</h4>
                      <p className="text-xs text-slate-400 leading-relaxed">
                        We calculate the <span className="text-white font-mono">Cosine Similarity</span> between your input vector <br/>
                        <span className="font-mono text-blue-300">A = [{preferences.action}, {preferences.story}, {preferences.visual}]</span> <br/>
                        and our database to find the mathematically closest matches.
                      </p>
                    </div>
                  </div>
                </div>

                {/* Right Column: Results */}
                <div className="md:col-span-7 lg:col-span-8">
                  <h2 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <span className="w-1 h-6 bg-emerald-500 rounded-full"></span>
                    Top Recommendations
                  </h2>
                  
                  <div className="space-y-4">
                    {recommendations.map((movie, index) => (
                      <MovieCard 
                        key={movie.id} 
                        movie={movie} 
                        rank={index + 1} 
                        userVector={preferences}
                      />
                    ))}
                  </div>

                  {recommendations.length === 0 && (
                    <div className="text-center py-20 text-slate-600">
                      No movies found. Try adjusting sliders.
                    </div>
                  )}
                </div>
              </main>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>